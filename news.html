<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>ë‰´ìŠ¤ ìš”ì•½ (API í‚¤ ë¶ˆí•„ìš”)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        color-scheme: light dark;
        --bg: #0f172a;
        --bg-card: #020617;
        --accent: #2563eb;
        --accent-soft: rgba(37, 99, 235, 0.15);
        --border-subtle: rgba(148, 163, 184, 0.3);
        --text-main: #e5e7eb;
        --text-muted: #9ca3af;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: radial-gradient(circle at top, #1f2937 0, #020617 55%, #000 100%);
        color: var(--text-main);
        display: flex;
        justify-content: center;
        padding: 24px;
      }

      .shell {
        width: 100%;
        max-width: 960px;
        border-radius: 24px;
        background: radial-gradient(circle at top left, #1e293b 0, #020617 60%);
        border: 1px solid rgba(148, 163, 184, 0.4);
        box-shadow:
          0 24px 80px rgba(15, 23, 42, 0.9),
          0 0 0 1px rgba(15, 23, 42, 0.9);
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      .shell-header {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 16px;
        background: linear-gradient(to right, #020617, #0b1120);
        border-bottom: 1px solid rgba(148, 163, 184, 0.4);
      }

      .traffic-lights {
        display: flex;
        gap: 6px;
      }

      .dot {
        width: 11px;
        height: 11px;
        border-radius: 999px;
      }

      .dot.red {
        background: radial-gradient(circle at 30% 30%, #fecaca, #f97373);
      }

      .dot.yellow {
        background: radial-gradient(circle at 30% 30%, #fef3c7, #facc15);
      }

      .dot.green {
        background: radial-gradient(circle at 30% 30%, #dcfce7, #22c55e);
      }

      .header-title {
        margin-left: 4px;
        font-size: 13px;
        color: var(--text-muted);
      }

      main {
        padding: 20px 22px 22px;
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .hero {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .hero-title {
        font-size: clamp(20px, 3vw, 24px);
        font-weight: 650;
        letter-spacing: -0.03em;
      }

      .hero-sub {
        font-size: 13px;
        color: var(--text-muted);
      }

      .search-card {
        border-radius: 18px;
        padding: 14px 14px 12px;
        background: radial-gradient(circle at top, rgba(37, 99, 235, 0.08), rgba(15, 23, 42, 0.95));
        border: 1px solid rgba(37, 99, 235, 0.4);
        box-shadow: 0 18px 40px rgba(15, 23, 42, 0.8);
      }

      form {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .input-row {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .input-wrapper {
        position: relative;
        flex: 1;
      }

      .input-prefix {
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 13px;
        color: var(--text-muted);
        pointer-events: none;
      }

      input[type="text"] {
        width: 100%;
        padding: 10px 12px 10px 32px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.5);
        background: rgba(15, 23, 42, 0.9);
        color: var(--text-main);
        font-size: 13px;
        outline: none;
        transition:
          border-color 120ms ease,
          box-shadow 120ms ease,
          background 120ms ease;
      }

      input[type="text"]::placeholder {
        color: rgba(148, 163, 184, 0.7);
      }

      input[type="text"]:focus {
        border-color: rgba(59, 130, 246, 0.9);
        box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.7);
        background: #020617;
      }

      button[type="submit"] {
        border: none;
        border-radius: 999px;
        padding: 9px 16px;
        font-size: 13px;
        font-weight: 560;
        letter-spacing: -0.01em;
        background: linear-gradient(135deg, #2563eb, #4f46e5);
        color: white;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        box-shadow:
          0 12px 30px rgba(37, 99, 235, 0.45),
          0 0 0 1px rgba(15, 23, 42, 0.9);
        transition:
          transform 100ms ease,
          box-shadow 100ms ease,
          filter 100ms ease;
        white-space: nowrap;
      }

      button[type="submit"]:hover {
        transform: translateY(-1px);
        filter: brightness(1.05);
        box-shadow:
          0 18px 40px rgba(37, 99, 235, 0.55),
          0 0 0 1px rgba(15, 23, 42, 0.9);
      }

      button[type="submit"]:active {
        transform: translateY(0);
        box-shadow:
          0 10px 18px rgba(15, 23, 42, 0.9),
          0 0 0 1px rgba(15, 23, 42, 0.9);
      }

      .hint-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 11px;
        color: var(--text-muted);
        margin-top: 2px;
      }

      .hint-keyword {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .chip {
        padding: 3px 8px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.45);
        background: rgba(15, 23, 42, 0.85);
      }

      .error {
        margin-top: 10px;
        padding: 8px 10px;
        border-radius: 12px;
        border: 1px solid rgba(248, 113, 113, 0.7);
        background: rgba(248, 113, 113, 0.08);
        color: #fecaca;
        font-size: 12px;
      }

      .api-settings {
        margin-top: 14px;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: rgba(15, 23, 42, 0.6);
      }
      .api-settings summary {
        cursor: pointer;
        font-size: 12px;
        color: var(--text-muted);
      }
      .api-settings-hint {
        font-size: 11px;
        color: var(--text-muted);
        margin: 8px 0 10px;
        line-height: 1.4;
      }
      .api-form {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
      }
      .api-form label {
        font-size: 12px;
        color: var(--text-muted);
      }
      .api-form input {
        margin-left: 4px;
        padding: 6px 10px;
        border-radius: 8px;
        border: 1px solid rgba(148, 163, 184, 0.5);
        background: rgba(15, 23, 42, 0.9);
        color: var(--text-main);
        font-size: 12px;
        min-width: 140px;
      }
      .api-form button {
        padding: 6px 12px;
        border-radius: 8px;
        border: 1px solid rgba(59, 130, 246, 0.6);
        background: rgba(37, 99, 235, 0.2);
        color: #93c5fd;
        font-size: 12px;
        cursor: pointer;
      }
      .api-form button:hover {
        background: rgba(37, 99, 235, 0.35);
      }
      .api-save-msg {
        margin-top: 8px;
        font-size: 11px;
      }
      .api-save-msg.success { color: #86efac; }
      .api-save-msg.fail { color: #fca5a5; }

      .results {
        margin-top: 6px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .result-header {
        font-size: 12px;
        color: var(--text-muted);
      }

      .news-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .news-item {
        border-radius: 14px;
        padding: 10px 11px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.4);
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .news-title-row {
        display: flex;
        align-items: baseline;
        gap: 6px;
      }

      .news-index {
        font-size: 11px;
        color: rgba(148, 163, 184, 0.9);
      }

      .news-title {
        font-size: 13px;
        font-weight: 560;
      }

      .news-summary {
        font-size: 12px;
        color: var(--text-muted);
      }

      .news-link {
        font-size: 11px;
      }

      .news-link a {
        color: #60a5fa;
        text-decoration: none;
      }

      .news-link a:hover {
        text-decoration: underline;
      }

      @media (max-width: 640px) {
        body {
          padding: 10px;
        }

        .shell {
          border-radius: 18px;
        }

        .input-row {
          flex-direction: column;
          align-items: stretch;
        }

        button[type="submit"] {
          justify-content: center;
          width: 100%;
        }

        .hint-row {
          flex-direction: column;
          align-items: flex-start;
          gap: 4px;
        }
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <header class="shell-header">
        <div class="traffic-lights">
          <div class="dot red"></div>
          <div class="dot yellow"></div>
          <div class="dot green"></div>
        </div>
        <div class="header-title">ë‰´ìŠ¤ ìš”ì•½ (ì„œë²„ ì—°ë™ Â· API í‚¤ ë¶ˆí•„ìš”)</div>
      </header>
      <main>
        <section class="hero">
          <div class="hero-title">í‚¤ì›Œë“œë¡œ ë³´ëŠ” ì˜¤ëŠ˜ì˜ ë‰´ìŠ¤</div>
          <p class="hero-sub">
            ì´ íŒŒì¼ë§Œ ì—´ì–´ë„ ê²€ìƒ‰ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì„œë²„Â·API í‚¤ ì—†ì´ ë™ì‘í•©ë‹ˆë‹¤.
          </p>
        </section>

        <section class="search-card">
          <form id="search-form">
            <div class="input-row">
              <div class="input-wrapper">
                <span class="input-prefix">ğŸ”</span>
                <input
                  type="text"
                  id="keyword-input"
                  placeholder="ì˜ˆ: ì¸ê³µì§€ëŠ¥, ê²½ì œ ì „ë§, ì£¼ì‹ ì‹œì¥..."
                  autofocus
                />
              </div>
              <button type="submit">
                ë‰´ìŠ¤ ìš”ì•½ ë³´ê¸°
                <span aria-hidden="true">â†’</span>
              </button>
            </div>
            <div class="hint-row">
              <span>ì›í•˜ëŠ” ì£¼ì œë‚˜ ì¢…ëª©ëª…ì„ ììœ ë¡­ê²Œ ì…ë ¥í•´ ë³´ì„¸ìš”.</span>
              <div class="hint-keyword">
                <span class="chip">IT</span>
                <span class="chip">ê²½ì œ</span>
                <span class="chip">ë¶€ë™ì‚°</span>
                <span class="chip">ì—”í„°</span>
              </div>
            </div>
          </form>

          <div id="error-box" class="error" style="display: none"></div>

          <details class="api-settings" id="api-settings">
            <summary>API ì„¤ì • (ë„¤ì´ë²„ ë‰´ìŠ¤ìš©, ì„ íƒ)</summary>
            <p class="api-settings-hint">
              ë„¤ì´ë²„ ê°œë°œì ì„¼í„°ì—ì„œ ë°œê¸‰í•œ Client ID / Client Secretì„ ì…ë ¥í•˜ë©´ ë„¤ì´ë²„ ë‰´ìŠ¤ë¡œ ê²€ìƒ‰ë©ë‹ˆë‹¤. ì„œë²„ì—ì„œ <strong>http://127.0.0.1:5000/news</strong> ë¡œ ì ‘ì†í–ˆì„ ë•Œë§Œ ì €ì¥ë©ë‹ˆë‹¤.
            </p>
            <div class="api-form">
              <label>Client ID <input type="text" id="naver-client-id" placeholder="ë„¤ì´ë²„ Client ID" autocomplete="off" /></label>
              <label>Client Secret <input type="password" id="naver-client-secret" placeholder="ë„¤ì´ë²„ Client Secret" autocomplete="off" /></label>
              <button type="button" id="api-save-btn">ì €ì¥</button>
            </div>
            <div id="api-save-msg" class="api-save-msg" style="display: none"></div>
          </details>
        </section>

        <section id="results-section" class="results" style="display: none">
          <div id="result-header" class="result-header"></div>
          <ul id="news-list" class="news-list"></ul>
        </section>
      </main>
    </div>

    <script>
      // ì„œë²„ ìˆìœ¼ë©´ /api/news ì‚¬ìš©, ì—†ìœ¼ë©´ CORS í”„ë¡ì‹œë¡œ êµ¬ê¸€ ë‰´ìŠ¤ RSS ì§ì ‘ ì¡°íšŒ (ì„œë²„ ë¶ˆí•„ìš”).
      const API_BASE =
        window.location.protocol === "file:"
          ? "http://127.0.0.1:5000"
          : "";
      const API_URL = API_BASE + "/api/news";
      const CORS_PROXIES = [
        "https://api.allorigins.win/raw?url=",
        "https://corsproxy.io/?url=",
      ];
      const GOOGLE_NEWS_RSS =
        "https://news.google.com/rss/search?q=KEYWORD&hl=ko&gl=KR&ceid=KR:ko";

      function cleanHtmlTags(text) {
        if (!text) return "";
        return text
          .replace(/<b>/g, "")
          .replace(/<\/b>/g, "")
          .replace(/&quot;/g, " ")
          .replace(/&apos;/g, " ")
          .replace(/&lt;/g, " ")
          .replace(/&gt;/g, " ")
          .replace(/&amp;/g, " ")
          .replace(/\s+/g, " ")
          .trim();
      }

      function simpleSummarize(title, description, maxLen) {
        maxLen = maxLen || 120;
        let text = cleanHtmlTags(description || "");
        if (!text) return cleanHtmlTags(title || "");
        let first = text.split(/[ã€‚.]/)[0].trim();
        if (first.length > maxLen) first = first.slice(0, maxLen - 1).trimEnd() + "â€¦";
        return first;
      }

      /** ì„œë²„ ì—†ì´ êµ¬ê¸€ ë‰´ìŠ¤ RSSë¥¼ CORS í”„ë¡ì‹œë¡œ ê°€ì ¸ì™€ íŒŒì‹± */
      async function searchNewsViaRss(keyword) {
        const rssUrl = GOOGLE_NEWS_RSS.replace(
          "KEYWORD",
          encodeURIComponent(keyword)
        );
        let xmlText = "";
        let lastErr = null;
        for (let i = 0; i < CORS_PROXIES.length; i++) {
          const url = CORS_PROXIES[i] + encodeURIComponent(rssUrl);
          try {
            const resp = await fetch(url, { method: "GET" });
            if (resp.ok) {
              xmlText = await resp.text();
              if (xmlText && xmlText.trim().length > 100) break;
            }
          } catch (e) {
            lastErr = e;
          }
        }
        if (!xmlText || xmlText.trim().length < 100)
          throw new Error(
            lastErr?.message || "RSSë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•˜ì„¸ìš”."
          );
        const parser = new DOMParser();
        const doc = parser.parseFromString(xmlText, "text/xml");
        const parseErr = doc.querySelector("parsererror");
        if (parseErr)
          throw new Error("RSS íŒŒì‹± ì‹¤íŒ¨. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");
        const itemNodes =
          doc.querySelectorAll("item").length > 0
            ? doc.querySelectorAll("item")
            : doc.querySelectorAll("entry");
        const items = [];
        const limit = 10;
        for (let i = 0; i < itemNodes.length && items.length < limit; i++) {
          const el = itemNodes[i];
          const title = (el.querySelector("title")?.textContent || "").trim();
          let link =
            (el.querySelector("link")?.textContent || "").trim() ||
            (el.querySelector("link")?.getAttribute("href") || "").trim();
          const desc =
            (el.querySelector("description")?.textContent || "").trim() ||
            (el.querySelector("summary")?.textContent || "").trim() ||
            (el.querySelector("content")?.textContent || "").trim();
          if (!title && !link) continue;
          const summary = simpleSummarize(title, desc);
          items.push({
            index: items.length + 1,
            title: title,
            description: desc,
            summary: summary,
            link: link || "#",
          });
        }
        return items;
      }

      async function searchNews(keyword) {
        // 1) ë¨¼ì € ìš°ë¦¬ ì„œë²„ API ì‹œë„
        try {
          const params = new URLSearchParams({ keyword: keyword });
          const resp = await fetch(`${API_URL}?${params.toString()}`, {
            method: "GET",
          });
          if (resp.ok) {
            const data = await resp.json();
            if (data.items && data.items.length) return data.items;
          }
        } catch (_) {}

        // 2) ì„œë²„ ì—†ìœ¼ë©´ êµ¬ê¸€ ë‰´ìŠ¤ RSSë¡œ ê²€ìƒ‰ (ì„œë²„ ë¶ˆí•„ìš”)
        return await searchNewsViaRss(keyword);
      }

      function showError(message) {
        const box = document.getElementById("error-box");
        box.textContent = message;
        box.style.display = "block";
      }

      function clearError() {
        const box = document.getElementById("error-box");
        box.style.display = "none";
        box.textContent = "";
      }

      function renderNews(keyword, items) {
        const section = document.getElementById("results-section");
        const header = document.getElementById("result-header");
        const list = document.getElementById("news-list");

        list.innerHTML = "";

        if (!items.length) {
          section.style.display = "none";
          header.textContent = "";
          return;
        }

        header.textContent = `"${keyword}" ê´€ë ¨ ìµœì‹  ë‰´ìŠ¤ ìš”ì•½ (${items.length}ê±´)`;

        items.forEach((item, idx) => {
          const title = cleanHtmlTags(item.title || "");
          const summary = item.summary != null ? item.summary : cleanHtmlTags(item.description || "");
          const link = item.link || "#";

          const li = document.createElement("li");
          li.className = "news-item";

          const titleRow = document.createElement("div");
          titleRow.className = "news-title-row";

          const indexEl = document.createElement("span");
          indexEl.className = "news-index";
          indexEl.textContent = `#${idx + 1}`;

          const titleEl = document.createElement("div");
          titleEl.className = "news-title";
          titleEl.textContent = title;

          titleRow.appendChild(indexEl);
          titleRow.appendChild(titleEl);

          const summaryEl = document.createElement("div");
          summaryEl.className = "news-summary";
          summaryEl.textContent = summary;

          const linkEl = document.createElement("div");
          linkEl.className = "news-link";

          const a = document.createElement("a");
          a.href = link;
          a.target = "_blank";
          a.rel = "noopener noreferrer";
          a.textContent = "ì›ë¬¸ ê¸°ì‚¬ ì—´ê¸°";

          linkEl.appendChild(a);

          li.appendChild(titleRow);
          li.appendChild(summaryEl);
          li.appendChild(linkEl);

          list.appendChild(li);
        });

        section.style.display = "flex";
      }

      document.getElementById("api-save-btn").addEventListener("click", async () => {
        const msgEl = document.getElementById("api-save-msg");
        const cid = (document.getElementById("naver-client-id").value || "").trim();
        const csec = (document.getElementById("naver-client-secret").value || "").trim();
        msgEl.style.display = "none";
        if (API_BASE === "") {
          try {
            const resp = await fetch("/api/naver-keys", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ client_id: cid, client_secret: csec }),
            });
            const data = await resp.json().catch(() => ({}));
            msgEl.textContent = data.message || (data.ok ? "ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤." : "ì €ì¥ ì‹¤íŒ¨");
            msgEl.className = "api-save-msg " + (data.ok ? "success" : "fail");
            msgEl.style.display = "block";
          } catch (err) {
            msgEl.textContent = "ì €ì¥ ì¤‘ ì˜¤ë¥˜: " + (err.message || "ì—°ê²° ì‹¤íŒ¨");
            msgEl.className = "api-save-msg fail";
            msgEl.style.display = "block";
          }
        } else {
          msgEl.textContent = "API í‚¤ ì €ì¥ì€ ì„œë²„ì—ì„œ http://127.0.0.1:5000/news ë¡œ ì ‘ì†í•œ ë’¤ ì‚¬ìš©í•˜ì„¸ìš”.";
          msgEl.className = "api-save-msg fail";
          msgEl.style.display = "block";
        }
      });

      document.getElementById("search-form").addEventListener("submit", async (e) => {
        e.preventDefault();
        clearError();

        const keywordInput = document.getElementById("keyword-input");
        const keyword = keywordInput.value.trim();

        if (!keyword) {
          showError("í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
          return;
        }

        const btn = e.target.querySelector('button[type="submit"]');
        const origText = btn ? btn.innerHTML : "";
        if (btn) btn.disabled = true;
        if (btn && btn.innerHTML.indexOf("ê²€ìƒ‰ ì¤‘") === -1)
          btn.innerHTML = "ê²€ìƒ‰ ì¤‘â€¦";
        try {
          const items = await searchNews(keyword);
          if (!items.length) {
            showError("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");
          } else {
            renderNews(keyword, items);
          }
        } catch (err) {
          console.error(err);
          showError(
            err.message || "ê²€ìƒ‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•œ ë’¤ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”."
          );
        } finally {
          if (btn) {
            btn.disabled = false;
            if (origText) btn.innerHTML = origText;
          }
        }
      });
    </script>
  </body>
</html>

